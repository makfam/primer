<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 N Parameters | Preceptor’s Primer for Bayesian Data Science</title>
<meta name="author" content="David Kane">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><script src="libs/plotly-binding-4.9.2.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script><script src="libs/rglWebGL-binding-0.103.5/rglWebGL.js"></script><link href="libs/rglwidgetClass-0.103.5/rgl.css" rel="stylesheet">
<script src="libs/rglwidgetClass-0.103.5/rglClass.min.js"></script><script src="libs/CanvasMatrix4-0.103.5/CanvasMatrix.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Preceptor’s Primer for Bayesian Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preamble.html">Preamble</a></li>
<li><a class="" href="shopping-week.html">Shopping Week</a></li>
<li><a class="" href="visualization.html"><span class="header-section-number">1</span> Visualization</a></li>
<li><a class="" href="wrangling.html"><span class="header-section-number">2</span> Wrangling</a></li>
<li><a class="" href="data.html"><span class="header-section-number">3</span> Data</a></li>
<li><a class="" href="rubin-causal-model.html"><span class="header-section-number">4</span> Rubin Causal Model</a></li>
<li><a class="" href="probability.html"><span class="header-section-number">5</span> Probability</a></li>
<li><a class="" href="one-parameter.html"><span class="header-section-number">6</span> One Parameter</a></li>
<li><a class="" href="two-parameters.html"><span class="header-section-number">7</span> Two Parameters</a></li>
<li><a class="" href="three-parameters.html"><span class="header-section-number">8</span> Three Parameters</a></li>
<li><a class="" href="four-parameters.html"><span class="header-section-number">9</span> Four Parameters</a></li>
<li><a class="" href="five-parameters.html"><span class="header-section-number">10</span> Five Parameters</a></li>
<li><a class="active" href="n-parameters.html"><span class="header-section-number">11</span> N Parameters</a></li>
<li><a class="" href="tools.html">Tools</a></li>
<li><a class="" href="functions.html">Functions</a></li>
<li><a class="" href="shiny.html">Shiny</a></li>
<li><a class="" href="maps.html">Maps</a></li>
<li><a class="" href="ipums.html">IPUMS</a></li>
<li><a class="" href="animation.html">Animation</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PPBDS/primer">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="n-parameters" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> N Parameters<a class="anchor" aria-label="anchor" href="#n-parameters"><i class="fas fa-link"></i></a>
</h1>
<!-- Two goals this week: -->
<!-- First, replace geom_pointrange with appropriate functions from ggdist. https://mjskay.github.io/ggdist/ Do not use tidy(). Start with 


fit_1 %>% 
  as_tibble() %>% 
  pivot_longer(cols = stateAlabama:stateWyoming,
               names_to = "state",
               values_to = "years") %>% 
  mutate(state = str_replace(state, "state", "")) %>%              
  ggplot(aes(x = vals, y = pulls)) +
  
  # Not these geoms. I think we just want pointinterval
  
  stat_halfeye(aes(fill = stat(cut_cdf_qi(cdf, .width = c(0.95, 1)))),
               show.legend = FALSE) +
  scale_fill_calc()


MF: Couldn't figure this out. Will attempt to fix tomorrow and submit new pull request.
-->
<!-- Second, make shaming part of chapter good! Population, temperance, Preceptor's Posterior, ideal Preceptor Table, testing. All the cool themes. Bring it all together. Make the students say Ahhh! -->
<!-- Where is the question that we are trying to answer? Do we answer them? Are they good questions? -->
<!-- Example: No discussion of population, validity, representativeness or ethics in Wisdom discussion. MF: Fixed.-->
<!-- * Should start with  single variable which actually requires lots of parameters. For example, death_age as a function of state and come up with a different average death_age for each state. This is cheating in that it is too many parameters, or rather that some of the parameters need to be estimated for too little data.  But it would allow us to explain a bunch of stuff! Including Bayesian shrinkage. Saving this till the end of the model causes us to miss stuff. But the rest of the analysis used lived_after. Which is better. Yes? Should we discuss? Use both? -->
<!-- Consider getting rid of state example, or moving it as a teaser to end of chaoter 10. Could we make a similar point with an example from shaming? -->
<p><em>This chapter is still a DRAFT.</em></p>
<p>Having created models with one parameter in Chapter <a href="one-parameter.html#one-parameter">6</a>, two parameters in Chapter <a href="two-parameters.html#two-parameters">7</a>, three parameters in Chapter <a href="three-parameters.html#three-parameters">8</a>, four parameters in Chapter <a href="four-parameters.html#four-parameters">9</a> and five parameters in Chapter <a href="five-parameters.html#five-parameters">10</a>, you are now ready to make the jump to <span class="math inline">\(N\)</span> parameters.</p>
<p>In this chapter, we will consider models with many parameters and the complexities that arise therefrom.</p>
<div id="more-on-candidate-longevity" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> More on candidate longevity<a class="anchor" aria-label="anchor" href="#more-on-candidate-longevity"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s continue our examination of the longevity of gubernatorial candidates which we began in Chapter <a href="five-parameters.html#five-parameters">10</a>. Recall the packages we need and the tibble we created:</p>
<div class="sourceCode" id="cb751"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">primer.data</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstanarm/">rstanarm</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span>

<span class="va">ch11</span> <span class="op">&lt;-</span> <span class="va">governors</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">last_name</span>, <span class="va">year</span>, <span class="va">state</span>, <span class="va">sex</span>, <span class="va">lived_after</span>, <span class="va">election_age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<!-- DK: Might discover that people who ran more than once are listed more than once. Or save that for Chapter 12. -->
<div id="state" class="section level3" number="11.1.1">
<h3>
<span class="header-section-number">11.1.1</span> state<a class="anchor" aria-label="anchor" href="#state"><i class="fas fa-link"></i></a>
</h3>
<p>Consider a model in which years lived after the election is a function of the state in which the candidate lives. This assumption generates a model with 51 parameters, one average value for each state and the residual variance. By excluding an intercept, we give the parameters an easier interpretation. With an intercept, the interpretation for each of the other <span class="math inline">\(\beta\)</span>’s would be as the difference in expected age relative to the first state.</p>
<p>Mathematics:</p>
<p><span class="math display">\[ lived\_after_i =  \beta_1 x_{AL,i} + \beta_2 x_{AK,i} + ... + \beta_{49} x_{WI,i}  + \beta_{50} x_{WY,i} + \epsilon_i\]</span>
As usual, <span class="math inline">\(\epsilon_i \sim N(0, \sigma^2)\)</span>. Conceptually, this model is identical to several of the three parameter models we explored in Chapter <a href="three-parameters.html#three-parameters">8</a>. For an individual candidate, the years to live after the election are function of the average for her state and of an error term. None of the other coefficients matter because the indicator variables are zero for all the other states. For example, the model for a candidate from Alaska simplifies to:</p>
<!-- DK: Make these all line up nicer? -->
<p><span class="math display">\[ lived\_after_i =  \beta_1 x_{AL,i} + \beta_2 x_{AK,i} + ... + \beta_{49} x_{WI,i}  + \beta_{50} x_{WY,i} + \epsilon_i \]</span>
<span class="math display">\[ lived\_after_i =  \beta_1 0 + \beta_2 1 + ... + \beta_{49} 0  + \beta_{50} 0 + \epsilon_i \]</span>
<span class="math display">\[ lived\_after_i =   \beta_2  + \epsilon_i \]</span>
The interpretation is the same as when we modeled <code>age</code> as a function of <code>party</code> or <code>att_end</code> as a function of <code>treatment</code> in Chapter <a href="three-parameters.html#three-parameters">8</a>. (Review those sections if this is unclear.) In all these cases, an individual can only be in one category. She can be a Democrat or a Republican. She can received the treatment or not. She can live in Alabama or Alaska or . . . . The only wrinkle we have added is that there are 50 categories under consideration, not just two.</p>
<p>The code is exactly the same as in those Chapter <a href="three-parameters.html#three-parameters">8</a> examples.</p>
<div class="sourceCode" id="cb752"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">lived_after</span> <span class="op">~</span> <span class="va">state</span> <span class="op">-</span> <span class="fl">1</span>,
                  data <span class="op">=</span> <span class="va">ch11</span>,
                  refresh <span class="op">=</span> <span class="fl">0</span>,
                  seed <span class="op">=</span> <span class="fl">76</span><span class="op">)</span></code></pre></div>
<p>We do not need to, explicitly, tell R that there are 50 categories. It determines that from <code>state</code>, just as it determined that there were two possibilities for <code>treatment</code>. The difficulty arises, however, when we try to examine the parameter values:</p>
<div class="sourceCode" id="cb753"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_1</span></code></pre></div>
<pre><code>## stan_glm
##  family:       gaussian [identity]
##  formula:      lived_after ~ state - 1
##  observations: 1092
##  predictors:   50
## ------
##                     Median MAD_SD
## stateAlabama        24.0    3.1  
## stateAlaska         27.4    3.5  
## stateArizona        31.2    2.3  
## stateArkansas       31.7    2.4  
## stateCalifornia     26.3    2.9  
## stateColorado       32.7    2.7  
## stateConnecticut    27.1    3.1  
## stateDelaware       34.5    3.0  
## stateFlorida        22.5    3.5  
## stateGeorgia        32.8    3.7  
## stateHawaii         25.3    4.2  
## stateIdaho          31.4    2.9  
## stateIllinois       24.1    3.3  
## stateIndiana        26.1    2.8  
## stateIowa           32.3    2.4  
## stateKansas         28.1    2.5  
## stateKentucky       29.6    3.0  
## stateLouisiana      26.8    3.7  
## stateMaine          32.3    3.3  
## stateMaryland       25.2    3.0  
## stateMassachusetts  25.5    2.5  
## stateMichigan       25.3    2.7  
## stateMinnesota      32.3    2.6  
## stateMississippi    26.6    3.1  
## stateMissouri       26.3    3.3  
## stateMontana        25.9    2.9  
## stateNebraska       26.1    2.6  
## stateNevada         27.7    3.3  
## stateNew Hampshire  30.1    2.5  
## stateNew Jersey     26.1    3.2  
## stateNew Mexico     29.1    2.3  
## stateNew York       23.3    2.6  
## stateNorth Carolina 22.7    3.8  
## stateNorth Dakota   29.4    2.6  
## stateOhio           29.1    2.5  
## stateOklahoma       26.0    3.2  
## stateOregon         25.2    3.0  
## statePennsylvania   26.8    3.0  
## stateRhode Island   32.1    2.0  
## stateSouth Carolina 33.0    3.3  
## stateSouth Dakota   23.5    2.5  
## stateTennessee      21.8    2.9  
## stateTexas          28.5    2.3  
## stateUtah           26.9    3.0  
## stateVermont        28.1    2.4  
## stateVirginia       30.3    3.7  
## stateWashington     31.1    3.0  
## stateWest Virginia  32.5    3.0  
## stateWisconsin      34.5    2.4  
## stateWyoming        20.7    2.9  
## 
## Auxiliary parameter(s):
##       Median MAD_SD
## sigma 13.2    0.3  
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>That is a lot to take in! Examining and comparing two parameters — the average attitude toward immigration of the treated and control, for example — is easy. Doing the same for 50 parameters is hard. The <strong>broom</strong> and <strong>broom.mixed</strong> packages were created to make this problem easier to manage, for all sorts of statistical models. For <strong>rstanarm</strong> models, we need the latter:</p>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/bbolker/broom.mixed">broom.mixed</a></span><span class="op">)</span></code></pre></div>
<p><code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> is the key function.</p>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_1_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">fit_1</span><span class="op">)</span>

<span class="va">fit_1_params</span></code></pre></div>
<pre><code>## # A tibble: 50 x 3
##    term             estimate std.error
##    &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;
##  1 stateAlabama         24.0      3.07
##  2 stateAlaska          27.4      3.52
##  3 stateArizona         31.2      2.27
##  4 stateArkansas        31.7      2.43
##  5 stateCalifornia      26.3      2.85
##  6 stateColorado        32.7      2.71
##  7 stateConnecticut     27.1      3.06
##  8 stateDelaware        34.5      2.97
##  9 stateFlorida         22.5      3.53
## 10 stateGeorgia         32.8      3.69
## # … with 40 more rows</code></pre>
<p>Putting all the parameters into a tibble makes everything much easier to interpret. For example, we can look at the states with the longest and shortest lived candidates:</p>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_1_params</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">46</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    term                estimate std.error
##    &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;
##  1 stateDelaware           34.5      2.97
##  2 stateWisconsin          34.5      2.38
##  3 stateSouth Carolina     33.0      3.34
##  4 stateGeorgia            32.8      3.69
##  5 stateColorado           32.7      2.71
##  6 stateNew York           23.3      2.63
##  7 stateNorth Carolina     22.7      3.85
##  8 stateFlorida            22.5      3.53
##  9 stateTennessee          21.8      2.93
## 10 stateWyoming            20.7      2.94</code></pre>
<p><!-- DK: Going forward, would you expect candidates from Delaware to live 14 years longer than candidates from Wyoming? Discuss what these terms mean. --></p>
<!-- DK: Should change this to use the ggdist package. -->
<p>A graphical display is the best way to examine numerous parameters at the same time.</p>
<div class="sourceCode" id="cb760"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_1_params</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">term</span>, <span class="st">"state"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">state</span>, <span class="va">estimate</span><span class="op">)</span>,
             y <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_pointrange</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">std.error</span>,
                        ymax <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">std.error</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Expected Years Lived Post Election"</span>,
         y <span class="op">=</span> <span class="st">"Years"</span>,
         x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-639-1.png" width="100%"></div>
<p>This is a lot to take in! If this looks overwhelming, don’t worry. Rather than our normal maximum of five parameters, we are looking at 51 parameters here, an average for 50 states and <span class="math inline">\(\sigma\)</span>. This is a big leap, and it is hard to absorb this much information at once.</p>
<p>As data scientists, the first question we must ask ourselves is whether or not we believe this data. Do we really expect the next candidate elected in Delaware to live significantly longer than the next candidate elected in Wyoming, or any other state? No! Of course not. We are modeling a relationship, but we cannot possibly claim that living in Delaware or Wyoming causes an increase or decrease in lifespan.</p>
<p>One possible explanation is that Wyoming tends to elect older candidates, which makes the years lived post-election smaller. Another possible explanation is that a few outliers — perhaps a candidate that died shortly after the election or a young candidate that lived an exceptionally long time after the election — are making the differences between the lowest and highest states more drastic. Yet another explanation could be that we have more observations for certain states, as compared to other states. The point we are making is: this is an interesting plot, but it is not <strong>the truth</strong>.</p>
<!-- DK: Switch above to using ggdist. -->
<!-- DK: Add a sensible discussion about whether or not we believe this.  MF: Done. -->
<!-- DK: In the next draft if this chapter, we ought to use a different data set which illustrates Bayesian shrinkage. Alas, does not work for this data because all the states have about the same number of observations. -->
</div>
<div id="state-election_age-sex-and-election_agesex" class="section level3" number="11.1.2">
<h3>
<span class="header-section-number">11.1.2</span> state, election_age, sex and election_age*sex<a class="anchor" aria-label="anchor" href="#state-election_age-sex-and-election_agesex"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s consider another model for <span class="math inline">\(lived\_age\)</span>, one which adds <code>state</code> to the model we used at the end of the previous chapter.</p>
<p>Math:</p>
<p><span class="math display">\[ lived\_after_i =  \beta_0 +  \beta_1 x_{AK,i} + \beta_2 x_{AR,i} + ... \beta_{49} x_{WY,i} + \\
\beta_{50} male_i + \beta_{51} election\_age_i+ \beta_{52} male_i *  election\_age_i + \epsilon_i\]</span></p>
<!-- DK: Clean this up. Explain meaning of intercept more clearly. -->
<ul>
<li><p><span class="math inline">\(lived\_after_i\)</span> is the outcome variable.</p></li>
<li><p><span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, <span class="math inline">\(\beta_3\)</span>… all the way to <span class="math inline">\(\beta_{49}\)</span> correspond to different parameters. These values are specific to each state. In order to find the female intercept (i.e. lived_after for females) for a specific state, you must add that state’s beta value to the value of <span class="math inline">\(\beta_0\)</span>. The resulting value provides you with the intercept for the <code>lived_after</code> outcome for females candidates in that specific state. For example, if you look at the model above, <span class="math inline">\(\beta_1\)</span> is the intercept value for Arkansas (note the AK subscript). You would take the appropriate value, which appears next to Arkansas in the printed model, and add it to the value for <span class="math inline">\(\beta_0\)</span>.</p></li>
<li><p><span class="math inline">\(\beta_0\)</span> will be the intercept for one state alone. When the model is printed, you will see that (Intercept) takes on the lived_after value for female candidates in Alabama.</p></li>
<li><p><span class="math inline">\(\beta_{50}\)</span> is the coefficient for the explanatory variable <span class="math inline">\(male_i\)</span>. When we are trying to find the intercepts for female candidates, the explanatory variable will take on the value of 0. However, <span class="math inline">\(male_i\)</span> = 1 when we are trying to find intercept values for male candidates. Therefore, to find the intercept value for male candidiates, there is an additional step: we add the <span class="math inline">\(\beta_{50}\)</span> value to the female intercept value.</p></li>
<li><p><span class="math inline">\(\beta_{51}\)</span> is the coefficient for the explanatory variable <span class="math inline">\(election\_age_i\)</span>. It is just the slope for women.</p></li>
<li><p><span class="math inline">\(\beta_{52}\)</span> is difficult to interpret. However, it gains meaning when it is added to <span class="math inline">\(\beta_{51}\)</span>, which results in the slope for men.</p></li>
</ul>
<!-- DK: Missing stuff here! --><div class="sourceCode" id="cb761"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_gov_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ch11</span>,
                      formula <span class="op">=</span> <span class="va">lived_after</span> <span class="op">~</span> <span class="va">state</span> <span class="op">+</span> <span class="va">sex</span><span class="op">*</span><span class="va">election_age</span>,
                      refresh <span class="op">=</span> <span class="fl">0</span>,
                      iter <span class="op">=</span> <span class="fl">10000</span>,
                      seed <span class="op">=</span> <span class="fl">98</span><span class="op">)</span></code></pre></div>
<p>Note that this takes awhile to run since we are dealing with 55 parameters here.</p>
<!-- DK: How do we not print out all the coefficients? -->
<div class="sourceCode" id="cb762"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">fit_gov_1</span>, detail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>##                      Median MAD_SD
## (Intercept)          16.6   21.2  
## stateAlaska           3.2    3.9  
## stateArizona          8.2    3.2  
## stateArkansas         1.6    3.2  
## stateCalifornia       5.7    3.5  
## stateColorado         4.2    3.3  
## stateConnecticut      2.9    3.5  
## stateDelaware         8.7    3.6  
## stateFlorida         -4.1    3.7  
## stateGeorgia          5.1    4.0  
## stateHawaii           4.4    4.3  
## stateIdaho            4.8    3.4  
## stateIllinois        -0.3    3.7  
## stateIndiana          3.5    3.6  
## stateIowa             2.7    3.2  
## stateKansas          -0.3    3.2  
## stateKentucky         4.2    3.5  
## stateLouisiana        4.0    4.0  
## stateMaine            5.9    3.7  
## stateMaryland         4.8    3.5  
## stateMassachusetts    0.4    3.2  
## stateMichigan        -3.0    3.4  
## stateMinnesota        4.6    3.3  
## stateMississippi      2.3    3.7  
## stateMissouri         1.5    3.7  
## stateMontana          2.5    3.5  
## stateNebraska         2.4    3.3  
## stateNevada           4.3    3.7  
## stateNew Hampshire    3.7    3.2  
## stateNew Jersey       1.2    3.6  
## stateNew Mexico       2.9    3.1  
## stateNew York         2.6    3.4  
## stateNorth Carolina  -3.9    3.9  
## stateNorth Dakota     6.0    3.4  
## stateOhio             6.1    3.3  
## stateOklahoma        -1.4    3.7  
## stateOregon           0.7    3.5  
## statePennsylvania     3.6    3.5  
## stateRhode Island     5.4    3.0  
## stateSouth Carolina   6.8    3.7  
## stateSouth Dakota    -4.9    3.2  
## stateTennessee       -1.1    3.6  
## stateTexas            3.4    3.2  
## stateUtah             3.4    3.5  
## stateVermont          1.7    3.3  
## stateVirginia         7.1    3.9  
## stateWashington       7.7    3.6  
## stateWest Virginia    6.8    3.5  
## stateWisconsin        6.9    3.2  
## stateWyoming         -1.3    3.5  
## sexMale              54.6   21.5  
## election_age         -0.1    0.4  
## sexMale:election_age -0.8    0.4  
## 
## Auxiliary parameter(s):
##       Median MAD_SD
## sigma 10.8    0.2</code></pre>
<p>The (Intercept) refers to the average number of years lived after the election for women from Alabama, who on the day of election, have been alive the average number of years of all female candidates! That’s a mouthful. It really is not different than what we have been doing all along, however. You can see here that (Intercept) value is around 17 years.</p>
<p>Thus far, we have only talked about female values. What about the male values? Well, if you look at the bottom of the list, you will see the <code>sexMale</code> value of around 55. When you wish to estimate <code>lived_after</code> for a specific state <em>for male candidates</em>, you must add this value to the intercept, and then also add the intercept of the desired state.</p>
<p><span class="math inline">\(\beta_{51}\)</span>, our coefficient value for <span class="math inline">\(election\_age_i\)</span>, is -0.06. When comparing female candidates who differ by one year in their current ages, there is not much of a difference in how many years we expect them to live after the election.</p>
<!-- DK: Conflict between $election\_age_i$ and `sexMale:election_age`. Which is better? Should be consistent. -->
<p><span class="math inline">\(\beta_{51} + \beta_{52}\)</span>, our coefficients for <span class="math inline">\(election\_age_i\)</span> and <code>sexMale:election_age</code>, results in the value of around -0.9. This value is our slope for men.</p>
<!-- DK: Clean up math here. No hard coding numbers!-->
<!-- ```{r} -->
<!-- fit_gov_1 %>%  -->
<!--   as_tibble() %>%  -->
<!--   mutate(Washington_females = `(Intercept)` + stateWashington) %>%  -->
<!--   mutate (SD_females = `(Intercept)` + `stateSouth Dakota`) %>%  -->
<!--   select(Washington_females, SD_females) %>%  -->
<!--   pivot_longer(cols = Washington_females:SD_females,  -->
<!--                names_to = "parameters", -->
<!--                values_to = "years") %>%  -->
<!--   ggplot(aes(years, fill = parameters)) + -->
<!--     geom_histogram(aes(y = after_stat(count/sum(count))), -->
<!--                    alpha = 0.5,  -->
<!--                    bins = 100,  -->
<!--                    position = "identity") + -->
<!--     labs(title = "Posterior Probability Distribution", -->
<!--          subtitle = "for women that live in Washington and South Dakota", -->
<!--          x = "Average Years Lived Post Election", -->
<!--          y = "Probability") +  -->
<!--     scale_x_continuous(labels = scales::number_format()) + -->
<!--     scale_y_continuous(labels = scales::percent_format()) + -->
<!--     theme_classic() -->
<!-- ``` -->
<!-- The posterior above shows that female candidates in Washington live longer after the election than female candidates in South Dakota. Interesting huh? Our knowledge about averages is always more precise than our knowledge about individuals.  -->
<!-- DK: Need to modify this to only show one of the more interesting state coefficients. (Although we might show all the state pdfs in the graphic.) This a good place to discuss shrinkage, which is what is happening here. And that is probably enough models. -->
</div>
</div>
<div id="wisdom-8" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Wisdom<a class="anchor" aria-label="anchor" href="#wisdom-8"><i class="fas fa-link"></i></a>
</h2>
<div class="figure">
<span id="fig:unnamed-chunk-642"></span>
<img src="other/images/Wisdom.jpg" alt="Wisdom" width="100%"><p class="caption">
FIGURE 11.1: Wisdom
</p>
</div>
<p>Imagine you are running for Governor and want to do a better job of getting your voters to vote. You recently read about a large-scale experiment showing the effect of sending out a voting reminder that “shames” citizens who do not vote. You are considering sending out a “shaming” voting reminder yourself.</p>
<p>Our questions are: <strong>What will happen if we do send a voting reminder? Will more voters show up to the polls? Additionally, on the day of the election, a female citizen is randomly selected. What is the probability she will vote?</strong></p>
<div id="eda-of-shaming" class="section level3" number="11.2.1">
<h3>
<span class="header-section-number">11.2.1</span> EDA of <code>shaming</code><a class="anchor" aria-label="anchor" href="#eda-of-shaming"><i class="fas fa-link"></i></a>
</h3>
<p>Consider a new data set, <code>shaming</code>, corresponding to an experiment carried out by Gerber, Green, and Larimer (2008) titled “Social Pressure and Voter Turnout: Evidence from a Large-Scale Field Experiment.” This experiment used several hundred thousand registered voters and a series of mailings to determine the effect of social pressure on voter turnout.</p>
<p>Let’s now do another EDA, starting off by running <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb764"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">primer.data</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr">skimr</a></span><span class="op">)</span>
<span class="fu">glimpse</span><span class="op">(</span><span class="va">shaming</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 344,084
## Columns: 15
## $ cluster       &lt;chr&gt; "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", "1", …
## $ primary_06    &lt;int&gt; 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1…
## $ treatment     &lt;fct&gt; Civic Duty, Civic Duty, Hawthorne, Hawthorne, Hawthorne…
## $ sex           &lt;chr&gt; "Male", "Female", "Male", "Female", "Female", "Male", "…
## $ age           &lt;int&gt; 65, 59, 55, 56, 24, 25, 47, 50, 38, 39, 65, 61, 57, 37,…
## $ primary_00    &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "…
## $ general_00    &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes", …
## $ primary_02    &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes", …
## $ general_02    &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "No", "Yes", "Yes", …
## $ primary_04    &lt;chr&gt; "No", "No", "No", "No", "No", "No", "No", "No", "No", "…
## $ general_04    &lt;chr&gt; "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes",…
## $ hh_size       &lt;int&gt; 2, 2, 3, 3, 3, 3, 3, 3, 2, 2, 1, 2, 2, 1, 2, 2, 2, 2, 1…
## $ hh_primary_04 &lt;dbl&gt; 0.095, 0.095, 0.048, 0.048, 0.048, 0.048, 0.048, 0.048,…
## $ hh_general_04 &lt;dbl&gt; 0.86, 0.86, 0.86, 0.86, 0.86, 0.90, 0.90, 0.90, 0.90, 0…
## $ neighbors     &lt;int&gt; 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,…</code></pre>
<p>We see that <code>glimpse()</code> gives us a look at the raw data contained within the <code>shaming</code> data set. At the very top of the output, we can see the number of rows and columns, or observations and variables respectively. We see that there are 344,084 observations, with each row corresponding to a unique respondent. This summary provides an idea of some of the variables we will be working with.</p>
<p>Variables of particular interest to us are <code>sex</code>, <code>hh_size</code>, and <code>primary_06</code>. The variable <code>hh_size</code> tells us the size of the respondent’s household, <code>sex</code> tells us the sex of the respondent, and <code>primary_06</code> tells us whether or not the respondent voted in the 2006 Primary election.
There are a few things to note while exploring this data set. You may – or may not – have noticed that the only response to the <code>general_04</code> variable is “Yes.” In their published article, the authors note that “Only registered voters who voted in November 2004 were selected for our sample” (Gerber, Green, Larimer, 2008). After this, the authors found their history then sent out the mailings. Thus, non-registered voters are excluded from our data.</p>
<p>It is also important to identify the dependent variable and its meaning. In this shaming experiment, the dependent variable is <code>primary_06</code>, which is a variable coded either 0 or 1 for whether or not the respondent voted in the 2006 primary election. This is the dependent variable because the authors are trying to measure the <strong>effect</strong> that the treatments have on voting behavior in the 2006 general election.</p>
<!-- HV: Should I include discussion of the left-hand variable (treatment?) here? Or wait until we move into the regressions? -->
<p>We have not yet discussed the most important variable of them all: <code>treatment</code>. The <code>treatment</code> variable is a factor variable with 5 levels, including the control. Since we are curious as to how sending mailings affects voter turnout, the treatment variable will tell us about the impact each type of mailing can make. Let’s start off by taking a broad look at the different treatments.</p>
<!-- HV: Is it okay to say the first sentence of this paragraph? -->
<div class="sourceCode" id="cb766"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shaming</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   treatment       n
##   &lt;fct&gt;       &lt;int&gt;
## 1 Control    191243
## 2 Civic Duty  38218
## 3 Hawthorne   38204
## 4 Self        38218
## 5 Neighbors   38201</code></pre>
<p>Four types of treatments were used in the experiment, with voters receiving one of the four types of mailing. All of the mailing treatments carried the message, “DO YOUR CIVIC DUTY - VOTE!”</p>
<p>The first treatment, Civic Duty, also read, “Remember your rights and responsibilities as a citizen. Remember to vote.” This message acted as a baseline for the other treatments, since it carried a message very similar to the one displayed on all the mailings.</p>
<p>In the second treatment, Hawthorne, households received a mailing which told the voters that they were being studied and their voting behavior would be examined through public records. This adds a small amount of social pressure to the households receiving this mailing.</p>
<p>In the third treatment, Self, the mailing includes the recent voting record of each member of the household, placing the word “Voted” next to their name if they did in fact vote in the 2004 election or a blank space next to the name if they did not. In this mailing, the households were also told, “we intend to mail an updated chart” with the voting record of the household members after the 2006 primary. By emphasizing the public nature of voting records, this type of mailing exerts more social pressure on voting than the Hawthorne treatment.</p>
<p>The fourth treatment, Neighbors, provides the household members’ voting records, as well as the voting records of those who live nearby. This mailing also told recipients, “we intend to mail an updated chart” of who voted in the 2006 election to the entire neighborhood.</p>
<p>For now, let’s focus on a subset of the data. We will sample just 10,000 rows because otherwise <code><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm()</a></code> takes an annoyingly large amount of time to work. Nothing substantive changes.</p>
<div class="sourceCode" id="cb768"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span>
<span class="va">ch9_sham</span> <span class="op">&lt;-</span> <span class="va">shaming</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="st">"Neighbors"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>solo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">hh_size</span> <span class="op">==</span> <span class="fl">1</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">primary_06</span>, <span class="va">treatment</span>, <span class="va">solo</span>, <span class="va">sex</span>, <span class="va">age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We create the variable <code>solo</code>, which is TRUE for voters who live alone and FALSE for those that do not. We are curious to see if the treatment effect, if any, is the same for voters who live alone as it is for those who do not. We have also focused in on only two “treatments”: Control and Neighbors. This is for the sake of simplification. We want to know if social pressure impacts voting behavior, so it makes sense to look at the treatment that provides the most social pressure.</p>
<div class="sourceCode" id="cb769"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ch9_sham</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-646">TABLE 11.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">10000</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">logical</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: character</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr></tbody>
</table></div>
<p><strong>Variable type: factor</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">treatment</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">Con: 8365, Nei: 1635</td>
</tr></tbody>
</table></div>
<p><strong>Variable type: logical</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">solo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.14</td>
<td align="left">FAL: 8560, TRU: 1440</td>
</tr></tbody>
</table></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">primary_06</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.31</td>
<td align="right">0.46</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▃</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">49.58</td>
<td align="right">14.49</td>
<td align="right">20</td>
<td align="right">41</td>
<td align="right">50</td>
<td align="right">59</td>
<td align="right">97</td>
<td align="left">▃▇▇▂▁</td>
</tr>
</tbody>
</table></div>
<p>Let’s focus on a few observations that may be relevant to our analysis. First, note that each treatment has approximately 38,000 respondents. The control group, denoted by <code>Con</code>, has approximately 190 thousand respondents. For the logical variable <code>solo</code>, we see that approximately 47 thousand of the total respondents live alone (TRUE), while approximately 296 thousand live in households greater than 1 (FALSE). It may also be important to note that the average age of the respondents is 49.8 years with a standard deviation of 14.4 years.</p>
</div>
</div>
<div id="population-1" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Population<a class="anchor" aria-label="anchor" href="#population-1"><i class="fas fa-link"></i></a>
</h2>
<p>One of the most important components of Wisdom is the concept of the “population.” Recall the questions we asked earlier:</p>
<p><em>What will happen if we do send a voting reminder today? Will more voters show up to the polls? Additionally, on the day of the election, a female citizen is randomly selected. What is the probability she will vote?</em></p>
<p>As we have discussed before, the population <em>is not</em> the set of people, or voters, for which we have data. This is the dataset. The population is the larger — potentially much larger — set of individuals about whom we want to make inferences.</p>
<p>There are many different populations, each with its own <span class="math inline">\(\mu\)</span>, in which we might be interested. For instance:</p>
<ul>
<li>The population for registered voters that voted in the 2004 election in the United States. This is the population for our dataset.</li>
<li>The population for registered voters that voted in any election from 1970 to 2040. We are often interested in the future. We want to make predictions about what <em>will</em> happen to voter habits, not what has already happened.</li>
<li>The population for registered <strong>and</strong> non-registered voters in the United States. Though it is helpful to look at registered voters, candidates also want to get non-registered voters to vote for them!</li>
<li>The population for voters — registered or not-registered — around the world. We might expect the habits of Americans to be similar to the habits of people in other countries. We might also believe that this is too broad a group to make inferences about.</li>
<li>Many more!</li>
</ul>
<p>In this case, we are viewing the data from the perspective of someone running for Governor this year that wants to increase voter turnout. We want to increase turnout <strong>now</strong>, not for people voting in 2006! We also may want to increase turnout in those citizens who are not registered to vote, a group that is excluded from our dataset. Is it reasonable to generate conclusions for this group? Most likely, no. However, we have limited data to work with and we have to determine how far we are willing to generalize to other groups.</p>
<p>It is a judgment call, a matter of Wisdom, as to whether or not that data we have is “close enough” to the population we are interested in to justify making a model.</p>
<p>Even though the original question is about “voters” in general, and does not specifically refer to specific states in which we might be interested, we will assume that the data we have for random voters is, uh, representative enough of the population we are interested in. If we did not believe that, then we should stop right now. <em>The major part of Wisdom is deciding what questions you can’t answer because of the data you just don’t have.</em></p>
<!-- DK: Add discussion of what you see here. No need to drop missing values since there aren't any. I think this next discussion can be dropped. -->
<!-- DK: Note that this situation is different from Chapter 8 in that fitted values and predicted values are not the same thing! The fitted value, for a combination of values for treatment and solo, is something 0.30, meaning that 30% of the people in this bucket votes. But the predicted value must be 0 or 1. Either you voted or you didn't. This example is clearly causal and so you need a Rubin Table with 5 potential outcome columns. The key difference in this chapter is that we are using lots of right hand side variables, both continuous and discrete. -->
</div>
<div id="justice-and-courage-1" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Justice and Courage<a class="anchor" aria-label="anchor" href="#justice-and-courage-1"><i class="fas fa-link"></i></a>
</h2>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-647"></span>
<img src="other/images/Justice.jpg" alt="Justice" width="60%"><p class="caption">
FIGURE 11.2: Justice
</p>
</div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-648"></span>
<img src="other/images/Courage.jpg" alt="Courage" width="60%"><p class="caption">
FIGURE 11.3: Courage
</p>
</div>
<p>Because we will be going through a series of models in this chapter, it is useful to combine the virtues of Justice and Courage. To begin, let’s model <code>primary_06</code>, which represents whether a citizen voted or not, against age and treatment to see if there is a connection.</p>
<div id="primary_06-treatment-age" class="section level3" number="11.4.1">
<h3>
<span class="header-section-number">11.4.1</span> primary_06 ~ treatment + age<a class="anchor" aria-label="anchor" href="#primary_06-treatment-age"><i class="fas fa-link"></i></a>
</h3>
<!-- What should the Preceptor tables look like with these models? Like chapter 3. Should each model have its own Preceptor Table? No! Just one preceptor table at the start, with 5 columns under Y, and 4 covariates, where one is treatment assigned. -->
<p>In this section, we will look at the relationship between primary voting and treatment + age. Note that <code>treatment</code> is a categorical explanatory variable and <code>age</code> is a continuous explanatory variable. This is the same type of model — parallel slopes — as we saw in Chapter <a href="four-parameters.html#four-parameters">9</a>.</p>
<p>The math:</p>
<p><span class="math display">\[ primary\_06_i =  \beta_0 + \beta_1 treatment_i + \beta_2 age_i + \epsilon_i \]</span></p>
<p>How do we interpret this?</p>
<ul>
<li>The outcome variable is <span class="math inline">\(primary\_06_i\)</span>, which represents whether someone voted in the 2006 primary election or not.</li>
<li>
<span class="math inline">\(treatment_i\)</span> is one of our explanatory variables. If we are predicting the voting behavior of someone under treatment, this value will be 1. When we are making this prediction for those in the control group, this value will be 0.</li>
<li>
<span class="math inline">\(age_i\)</span> is our other explanatory variable. It is the number of years a voter has lived at the time of the election.</li>
<li><ul>
<li>
<span class="math inline">\(\beta_0\)</span> is the voting percentage for those in the control group, who on the day of election, have been alive for 0 years of age. Clearly, age is nonsensical in this paradigm. <span class="math inline">\(\beta_0\)</span> is also the intercept of the equation. In other words, <span class="math inline">\(\beta_0\)</span> is the expected value of <span class="math inline">\(primary\_06_i\)</span>, if <span class="math inline">\(treatment_i = 0\)</span> and <span class="math inline">\(age_i = 0\)</span>.</li>
</ul></li>
<li>
<span class="math inline">\(\beta_1\)</span> is almost meaningless by itself. The only time it has meaning is when its value is connected to our intercept (i.e. <span class="math inline">\(\beta_0 + \beta_1\)</span>). When the two are added together, you get the percentage voting for those in the treatment group, who on the day of election, have been alive for zero years of age.</li>
<li>
<span class="math inline">\(\beta_2\)</span> is, for the entire population, the average difference in <span class="math inline">\(primary\_06_i\)</span> between two individuals, one of whom has an <span class="math inline">\(age_i\)</span> value of 1 greater than the other.</li>
</ul>
<p>Let’s translate the model into code.</p>
<div class="sourceCode" id="cb770"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ch9_sham</span>, 
                 formula <span class="op">=</span> <span class="va">primary_06</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">age</span>, 
                 refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb771"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">model_3</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## stan_glm
##  family:       gaussian [identity]
##  formula:      primary_06 ~ treatment + age
##  observations: 10000
##  predictors:   3
## ------
##                    Median MAD_SD
## (Intercept)        0.084  0.017 
## treatmentNeighbors 0.079  0.012 
## age                0.004  0.000 
## 
## Auxiliary parameter(s):
##       Median MAD_SD
## sigma 0.458  0.003 
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>The <code>(Intercept)</code> here is the intercept for the Control group, our baseline for comparison. The <code>(Intercept)</code> does have a mathematical interpretation, but it does not have a practical interpretation. Why is this? Because the slope for age starts at zero. This is nonsensical for our purposes, as no voter can be of zero age.</p>
<p>Therefore, this model shows that, within the control group, the percent voting is 0.08 times 100.</p>
<p>How do we calculate our percent voting in the Neighbors group? Recall that the <code>treatmentNeighbors</code> median is not giving a standalone figure for this group, but rather represents the offset between the Control and Neighbors groups. To find the Neighbors value, we must add the offset to the original value: 0.16. This is nearly double the rate in the Control group!</p>
<p>Let’s turn to our age median. Begin by grouping our observations by <code>age</code> and counting by <code>primary_06</code>, which gives us counts for 1 (yes) or 0 (no) for number voting in each age category.</p>
<div class="sourceCode" id="cb773"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">ch9_sham</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">primary_06</span><span class="op">)</span> 

<span class="va">age</span></code></pre></div>
<pre><code>## # A tibble: 149 x 3
## # Groups:   age [77]
##      age primary_06     n
##    &lt;int&gt;      &lt;int&gt; &lt;int&gt;
##  1    20          0   119
##  2    20          1    15
##  3    21          0   120
##  4    21          1    15
##  5    22          0   150
##  6    22          1    24
##  7    23          0   119
##  8    23          1    19
##  9    24          0   102
## 10    24          1    21
## # … with 139 more rows</code></pre>
<p>To explore this relationship visually, let’s create a graph. We are coercing <code>primary_06</code> into a character variable as it more closely represents “yes” or “no” as opposed to a numeric value.</p>
<div class="sourceCode" id="cb775"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>primary_06 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">primary_06</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">n</span>, color <span class="op">=</span> <span class="va">primary_06</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Relationship Between Age and Voting"</span>,
    subtitle <span class="op">=</span> <span class="st">"In the 2006 Primary Elections"</span>,
    x <span class="op">=</span> <span class="st">"Age"</span>,
    y <span class="op">=</span> <span class="st">"Count"</span>,
    color <span class="op">=</span> <span class="st">"Did they vote?"</span>,
    caption <span class="op">=</span> <span class="st">"1 = yes, 0 = no"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-652-1.png" width="100%"></div>
<p>There are some interesting takeaways here.
- First, in almost every age bracket (other than above 90), the majority participants did <em>not</em> vote.
- The spike between ages 40 and 60 illustrates that most participants exist in this age bracket.
- The differences between voters and non-voters narrows greatly after age 60.</p>
<p>Let’s now look at another graph that aims to show the same phenomena, but also includes a formula using <code>lm</code>. This more clearly shows the upward trend in voting as a participants age increases. We can also see that the highest concentrations in the “Voted” row exist from ages 45-50, whereas the highest concentrations for the “Did Not Vote” row exist in the 18-25 and 30-60 age groups. Again, we see that, for almost all ages, the partcipants are more likely to not vote than vote. This is illustrated by the darker concentration of dots in the “Did Not Vote” row. The slope of our regression line, however, shows a clear picture: the older you are, the more likely you are to vote.</p>
<div class="sourceCode" id="cb776"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shaming</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">age</span>, <span class="va">primary_06</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_jitter</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.005</span>, height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_smooth</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Did Not Vote"</span>, <span class="st">"Voted"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age and Voting in 2012 Michigan Primary Election"</span>, 
       subtitle <span class="op">=</span> <span class="st">"Older people are more likely to vote"</span>, 
       x <span class="op">=</span> <span class="st">"Age"</span>, 
       y <span class="op">=</span> <span class="cn">NULL</span>, 
       caption <span class="op">=</span> <span class="st">"Data from Gerber, Green, and Larimer (2008)"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-653-1.png" width="100%"></div>
<p>Note that the median for age is 0. Age is therefore positively correlated with voting in the primary election. What does that mean? It means that, for every year that a participant’s age increases, their odds of voting in the primary <em>increases</em> by 0. Now, this might not seem like a huge difference. However, think of it like this: for every decade older that a participant is, their odds of voting increase 0 %! This makes sense considering that we just learned that older citizens are more likely to vote.</p>
<p>Now, let’s return to our voting difference between the Control and Neighbors groups. Let’s model the posterior probability distribution for the rates of voting.</p>
<div class="sourceCode" id="cb777"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_3</span> <span class="op">%&gt;%</span>  
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Neighbors <span class="op">=</span> <span class="va">`(Intercept)`</span> <span class="op">+</span> <span class="va">`treatmentNeighbors`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Control <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Neighbors</span>, <span class="va">Control</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Neighbors</span><span class="op">:</span><span class="va">Control</span>, 
               names_to <span class="op">=</span> <span class="st">"parameters"</span>, 
               values_to <span class="op">=</span> <span class="st">"percent_voting"</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">percent_voting</span>, fill <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                   alpha <span class="op">=</span> <span class="fl">0.5</span>,  
                   bins <span class="op">=</span> <span class="fl">100</span>,  
                   position <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Posterior Probability Distribution"</span>, 
         subtitle <span class="op">=</span> <span class="st">"for Control versus Neighbors voting rates"</span>, 
        x <span class="op">=</span> <span class="st">"% of group voting"</span>, 
        y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span>  
   <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-654-1.png" width="100%"></div>
<p>This is interesting. Here, we can see that the difference between the expected voting behavior between Control and Neighbors is meaningful. There is only a very small overlap where it is more likely for those in Control to vote when compared with those in the treatment group. This bodes well for our election, as we see that the treatment makes a large difference.</p>
<p>However, there is one caveat to this plot: it is the posterior for those with voting age zero, which is nonsense! Is this helpful for <em>our</em> election? Not really, since our voters are likely to be… well, not zero years old.</p>
<p>Let’s modify <code>age</code> to be the average age for the dataset. We will use the mean of election_age, which is about 50. Once we find this number, we will subtract it from every <code>age</code> value, creating a new variable: <code>c_age</code>, where the “c” stand for centered. <code>c_age</code> is the number of years a voter has been alive, as of Election Day, relative to the average years alive of all voters on election day.</p>
<div class="sourceCode" id="cb778"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ch9_sham</span> <span class="op">&lt;-</span> <span class="va">ch9_sham</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>c_age <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Create our model:</p>
<div class="sourceCode" id="cb779"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ch9_sham</span>, 
                 formula <span class="op">=</span> <span class="va">primary_06</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">c_age</span>, 
                 refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>Look at results:</p>
<div class="sourceCode" id="cb780"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">model_4</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## stan_glm
##  family:       gaussian [identity]
##  formula:      primary_06 ~ treatment + c_age
##  observations: 10000
##  predictors:   3
## ------
##                    Median MAD_SD
## (Intercept)        0.297  0.005 
## treatmentNeighbors 0.079  0.013 
## c_age              0.004  0.000 
## 
## Auxiliary parameter(s):
##       Median MAD_SD
## sigma 0.457  0.003 
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Now that we have a more sensible value for age, let’s create the posterior:</p>
<div class="sourceCode" id="cb782"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_4</span> <span class="op">%&gt;%</span>  
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Neighbors <span class="op">=</span> <span class="va">`(Intercept)`</span> <span class="op">+</span> <span class="va">`treatmentNeighbors`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Control <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Neighbors</span>, <span class="va">Control</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Neighbors</span><span class="op">:</span><span class="va">Control</span>, 
               names_to <span class="op">=</span> <span class="st">"parameters"</span>, 
               values_to <span class="op">=</span> <span class="st">"percent_voting"</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">percent_voting</span>, fill <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                   alpha <span class="op">=</span> <span class="fl">0.5</span>,  
                   bins <span class="op">=</span> <span class="fl">100</span>,  
                   position <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Posterior Probability Distribution"</span>, 
         subtitle <span class="op">=</span> <span class="st">"for Control versus Neighbors voting rates"</span>, 
        x <span class="op">=</span> <span class="st">"% of group voting"</span>, 
        y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span>  
   <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-658-1.png" width="100%"></div>
<p>As we can see, this plot is quite different! This plot is showing, rather than the posterior for age 0, the posterior for the average age in the dataset, which is about 50. In this example, where <code>c_age</code> is more meaningful, the difference between the estimates for percent voting within <code>Control</code> and <code>Neighbors</code> is even greater. In fact, there is no overlap between the groups. According to this model, we would <em>never</em> expect for someone in the <code>Control</code> group to be more likely to vote than someone in the <code>Neighbors</code> group.</p>
</div>
<div id="primary_06-c_age-treatment-solotreatment" class="section level3" number="11.4.2">
<h3>
<span class="header-section-number">11.4.2</span> primary_06 ~ c_age + treatment + solo*treatment<a class="anchor" aria-label="anchor" href="#primary_06-c_age-treatment-solotreatment"><i class="fas fa-link"></i></a>
</h3>
<p>It is time to look at interactions! Here, we will look at <code>primary_06</code> as a function of <code>c_age</code>, <code>treatment</code>, and <code>solo*treatment</code>. What does <code>solo*treatment</code> mean for us? It means we are looking at the <code>solo</code> and <code>treatment</code> variables as they correspond to one another.</p>
<p>To emphasize the focus on multiple parameters, we will also be working with <em>every type of treatment</em>, rather than only the Neighbors treatment. To make age sensible, let’s perform the same mutation as before:</p>
<div class="sourceCode" id="cb783"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shaming</span> <span class="op">&lt;-</span> <span class="va">shaming</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>c_age <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Transform into code:</p>
<div class="sourceCode" id="cb784"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shaming</span>, 
                 formula <span class="op">=</span> <span class="va">primary_06</span> <span class="op">~</span> <span class="va">c_age</span> <span class="op">+</span>  <span class="va">treatment</span> <span class="op">+</span> <span class="va">c_age</span><span class="op">*</span><span class="va">treatment</span>, 
                 refresh <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>Observe the findings:</p>
<div class="sourceCode" id="cb785"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">model_5</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## stan_glm
##  family:       gaussian [identity]
##  formula:      primary_06 ~ c_age + treatment + c_age * treatment
##  observations: 344084
##  predictors:   10
## ------
##                           Median MAD_SD
## (Intercept)               0.297  0.001 
## c_age                     0.004  0.000 
## treatmentCivic Duty       0.018  0.003 
## treatmentHawthorne        0.026  0.003 
## treatmentSelf             0.048  0.003 
## treatmentNeighbors        0.081  0.003 
## c_age:treatmentCivic Duty 0.000  0.000 
## c_age:treatmentHawthorne  0.000  0.000 
## c_age:treatmentSelf       0.001  0.000 
## c_age:treatmentNeighbors  0.001  0.000 
## 
## Auxiliary parameter(s):
##       Median MAD_SD
## sigma 0.460  0.001 
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Tidy the model:</p>
<div class="sourceCode" id="cb787"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_5</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    term                      estimate std.error
##    &lt;chr&gt;                        &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)               0.297    0.00101  
##  2 c_age                     0.00400  0.0000726
##  3 treatmentCivic Duty       0.0185   0.00251  
##  4 treatmentHawthorne        0.0261   0.00263  
##  5 treatmentSelf             0.0484   0.00267  
##  6 treatmentNeighbors        0.0811   0.00260  
##  7 c_age:treatmentCivic Duty 0.000253 0.000177 
##  8 c_age:treatmentHawthorne  0.000334 0.000187 
##  9 c_age:treatmentSelf       0.000782 0.000181 
## 10 c_age:treatmentNeighbors  0.000629 0.000180</code></pre>
<div class="sourceCode" id="cb789"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_5</span></code></pre></div>
<pre><code>## stan_glm
##  family:       gaussian [identity]
##  formula:      primary_06 ~ c_age + treatment + c_age * treatment
##  observations: 344084
##  predictors:   10
## ------
##                           Median MAD_SD
## (Intercept)               0.3    0.0   
## c_age                     0.0    0.0   
## treatmentCivic Duty       0.0    0.0   
## treatmentHawthorne        0.0    0.0   
## treatmentSelf             0.0    0.0   
## treatmentNeighbors        0.1    0.0   
## c_age:treatmentCivic Duty 0.0    0.0   
## c_age:treatmentHawthorne  0.0    0.0   
## c_age:treatmentSelf       0.0    0.0   
## c_age:treatmentNeighbors  0.0    0.0   
## 
## Auxiliary parameter(s):
##       Median MAD_SD
## sigma 0.5    0.0   
## 
## ------
## * For help interpreting the printed output see ?print.stanreg
## * For info on the priors used see ?prior_summary.stanreg</code></pre>
<p>Recall the math for this section. To find the intercepts for each of the treatments, you need to add them to the <code>(Intercept)</code>.</p>
<ul>
<li>Intercept for Control (which is just the original intercept): 0.08 .</li>
<li>Intercept for Civic Duty, which is found by adding <code>treatmentCivic Duty</code> to the <code>(Intercept)</code>: 0.32.</li>
<li>Intercept for Hawthorne, which is found by adding <code>treatmentHawthorne</code> to the <code>(Intercept)</code>: 0.32</li>
<li>Intercept for Self, which is found by adding <code>treatmentSelf</code> to the <code>(Intercept)</code>: 0.34</li>
<li>Intercept for Neighbors, which is found my adding <code>treatmentNeighbors</code> to the <code>(Intercept)</code>: 0.38.</li>
</ul>
<p>Recall that, in order to find the appropriate slopes for each treatment, we need to add the interaction terms to the original value for <code>c_age</code>:</p>
<ul>
<li>Slope for Control (which is the standalone value for <code>c_age</code>): 0.</li>
<li>Slope for Civic Duty, which is found my adding <code>c_age:treatmentCivic Duty</code> to <code>c_age</code>: 0.</li>
<li>Slope for Hawthorne, which is found by adding <code>c:age:treatmentHawthorne</code> to <code>c_age</code>: 0.</li>
<li>Slope for Self, which is found by adding <code>c_age:treatmentSelf</code> to <code>c_age</code>: 0</li>
<li>Slope for Neighbors, which is found by adding <code>c_age:treatmentNeighbors</code> to <code>c_age</code>: 0</li>
</ul>
<p>Whew! That was a lot. However, it is important to understanding how to interpret the results of our model.</p>
<p>Now, we will look at the posterior probability distribution for our various treatments:</p>
<div class="sourceCode" id="cb791"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_5</span> <span class="op">%&gt;%</span>  
  <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Control <span class="op">=</span> <span class="va">`(Intercept)`</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  
  <span class="co"># Add the intercepts to each appropriate treatment term. </span>
  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Neighbors <span class="op">=</span> <span class="va">`(Intercept)`</span> <span class="op">+</span> <span class="va">`treatmentNeighbors`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Civic_Duty <span class="op">=</span> <span class="va">`(Intercept)`</span> <span class="op">+</span> <span class="va">`treatmentCivic Duty`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Hawthorne <span class="op">=</span> <span class="va">`(Intercept)`</span> <span class="op">+</span> <span class="va">`treatmentHawthorne`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Self <span class="op">=</span> <span class="va">`(Intercept)`</span> <span class="op">+</span> <span class="va">`treatmentSelf`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="co"># Select columns for each treatment.</span>
  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Control</span>, <span class="va">Neighbors</span>, <span class="va">Civic_Duty</span>, <span class="va">Hawthorne</span>, <span class="va">Self</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># Pivot_longer and create plot. </span>
  
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="va">Control</span><span class="op">:</span><span class="va">Self</span>, 
               names_to <span class="op">=</span> <span class="st">"parameters"</span>, 
               values_to <span class="op">=</span> <span class="st">"percent_voting"</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">percent_voting</span>, fill <span class="op">=</span> <span class="va">parameters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                   alpha <span class="op">=</span> <span class="fl">0.5</span>,  
                   bins <span class="op">=</span> <span class="fl">100</span>,  
                   position <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Posterior Probability Distribution"</span>, 
         subtitle <span class="op">=</span> <span class="st">"Comparing voting rates for treatments"</span>, 
        x <span class="op">=</span> <span class="st">"% of group voting"</span>, 
        y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span>  
   <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">scale_y_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
   <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-663-1.png" width="100%"></div>
<p>This is interesting! By using all forms of treatment, we can see the differences in voting behavior. Note that the distribution for Control is much higher, as the Control group has more observations.</p>
<p>We see that, according to our posterior, the Neighbors treatment is most effective — this group votes the most. The Self treatment is also demonstrating an influence on voting behavior, as compared with the Control group. The Hawthorn and Civic Duty treatments are also increasing voting as compared to the control, with some overlap. Thus, the Hawthorne and Civic Duty are not as impactful and, at certain points, are interchangable in terms of which one is more impactful.</p>
</div>
</div>
<div id="temperance-8" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Temperance<a class="anchor" aria-label="anchor" href="#temperance-8"><i class="fas fa-link"></i></a>
</h2>
<div class="figure">
<span id="fig:unnamed-chunk-664"></span>
<img src="other/images/Temperance.jpg" alt="Temperance" width="100%"><p class="caption">
FIGURE 11.4: Temperance
</p>
</div>
<p>Finally, let’s remember the virtue of Temperance. The gist of temperance is: be humble with our inferences, as our inferences are always, certainly, and unfortunately not going to match the real world. How does this apply to our shaming scenario?</p>
<p>Prediction uncertainty is the main culprit. No matter how hard we try, <em>we cannot predict the future</em>. Though we now have conclusions about how shaming impacted voters in the 2006 primary elections, we do not have the confidence to say that what worked or didn’t work then would work now.</p>
<p>For instance, perhaps the impact of your neighbors knowing your voting history is greater in the midst of a pandemic, where you may be locked inside with few interactions outside of your immediate proximity. Perhaps the opposite is true. These <em>unknown unknowns</em> cannot be accounted for in our models. We cannot predict a pandemic, nor can we predict how this will change the way that people vote or respond to fliers.</p>
<p>There is also the issue of representativeness. Do the voters of the 2006 primary election (who have already demonstrated a willingness to vote in the 2004 primary election) truly represent the people voting in <strong>our</strong> gubernatorial election?</p>
<p>These complications are why we must make inferences with a grain of salt. That is not to say that all data science is unhelpful! On the contrary, acknowledging our deficits will only make our inferences (and the actions we take because of them) stronger.</p>
<!-- What we need to add: Preceptor table, causal explanation, math before models, posterior_epred. -->
</div>
<div id="summary-10" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> Summary<a class="anchor" aria-label="anchor" href="#summary-10"><i class="fas fa-link"></i></a>
</h2>
<p><em>Key commands</em>:
* Use the <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> function from the <strong>broom.mixed</strong> package to make models with <span class="math inline">\(N\)</span> parameters easier to interpret.
* A function we are familiar with, <code><a href="https://mc-stan.org/rstanarm/reference/stan_glm.html">stan_glm()</a></code>, is used to create models with <span class="math inline">\(N\)</span> parameters.</p>
<p><em>Remember</em>:
* It is important to remember that the data does not equal the truth. For instance, in regards to our first model, we do not expect a governor elected in Delaware to live significantly longer than a governor in Wyoming.
* The population we would like to make inferences about <em>is not the population for which we have data</em>. It is a matter of wisdom whether the data we do have maps closely enough to the population we are studying.
* When dealing with models with many parameters, double check that you know how to find the true slope and intercepts — often, this requires adding numerous values to the coefficient you are studying.</p>

<!-- Fix images in UNIX section so that they use 1005 instead, to match the new text. -->
<!-- Explain importance of scripting versus click-and-drag and copy-pasting. Add section about useful keyboard shortcuts. -->
<!-- Add material about file organization. -->
<!-- Find a place to mention all the high quality sources listed below. Maybe with a webshot of their title pages?  -->
<!-- Happy Git for the R User. -->
<!-- Anything associated with RStudio. -->
<!-- [The UNIX Workbench](https://seankross.com/the-unix-workbench/), but with all the work done form the terminal window in RStudio.  -->
<!-- [What They Forgot to Teach You About R](https://rstats.wtf/) -->
<!-- https://usethis.r-lib.org/articles/articles/usethis-setup. Might just pull out the key sections of this. We can't just link to it since some of it --- like devtools --- is too confusing. -->
<!-- https://merely-useful.github.io/py-rse/ -->
<!-- Consider making the **fs** package a major part of the presentation. This helps avoid dealing with cross-OS issues ourselves. Also teaches students that there is more than one way to interact with the file system. -->
<!-- Add some optional videos, especially the ones from RStudio which give nice tours of RStudio stuff. -->
<!-- Buttons we press should be bolded, not wrapped with backticks. -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="five-parameters.html"><span class="header-section-number">10</span> Five Parameters</a></div>
<div class="next"><a href="tools.html">Tools</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#n-parameters"><span class="header-section-number">11</span> N Parameters</a></li>
<li>
<a class="nav-link" href="#more-on-candidate-longevity"><span class="header-section-number">11.1</span> More on candidate longevity</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#state"><span class="header-section-number">11.1.1</span> state</a></li>
<li><a class="nav-link" href="#state-election_age-sex-and-election_agesex"><span class="header-section-number">11.1.2</span> state, election_age, sex and election_age*sex</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#wisdom-8"><span class="header-section-number">11.2</span> Wisdom</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#eda-of-shaming"><span class="header-section-number">11.2.1</span> EDA of shaming</a></li></ul>
</li>
<li><a class="nav-link" href="#population-1"><span class="header-section-number">11.3</span> Population</a></li>
<li>
<a class="nav-link" href="#justice-and-courage-1"><span class="header-section-number">11.4</span> Justice and Courage</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#primary_06-treatment-age"><span class="header-section-number">11.4.1</span> primary_06 ~ treatment + age</a></li>
<li><a class="nav-link" href="#primary_06-c_age-treatment-solotreatment"><span class="header-section-number">11.4.2</span> primary_06 ~ c_age + treatment + solo*treatment</a></li>
</ul>
</li>
<li><a class="nav-link" href="#temperance-8"><span class="header-section-number">11.5</span> Temperance</a></li>
<li><a class="nav-link" href="#summary-10"><span class="header-section-number">11.6</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PPBDS/primer/blob/master/11-n-parameters.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PPBDS/primer/edit/master/11-n-parameters.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Preceptor’s Primer for Bayesian Data Science</strong>" was written by David Kane. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
